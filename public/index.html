<!DOCTYPE html>
<html ng-app="">
<head>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
</head>
<body >

<div class="container">
	<h3>TV shows</h3>

	<div ng-app="" ng-controller="tvshowsController" ng-init="showEdition=false"> 

		<table class="table table-striped">
			<thead>
				<tr>
					<th>Edit</th>
					<th>Title</th>
					<th>Year</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="tvshow in tvshows | orderBy : 'title'">
					<td>
						<button class="btn" ng-click="editController(tvshow)">
							<span class="glyphicon glyphicon-pencil"></span>  Edit
						</button>
					</td>				
					<td>{{ tvshow.title }}</td>
					<td>{{ tvshow.year }}</td>
				</tr>
			</tbody>
		</table>

		<br>
		<div ng-show="showEdition">
			<h3>TV Show:</h3>
			<form class="form-horizontal">
                <input type="hidden" ng-model="id"/>
				<div class="form-group">
					<label class="col-sm-2 control-label">Title:</label>
					<div class="col-sm-10">
						<input type="text" ng-model="title" placeholder="Title">
					</div>
				</div> 
				<div class="form-group">
					<label class="col-sm-2 control-label">Year:</label>
					<div class="col-sm-10">
						<input type="text" ng-model="year" placeholder="Year">
					</div>
				</div>
			</form>

			<hr>
			<button class="btn btn-success" ng-click="saveController(id,title,year)">
				<span class="glyphicon glyp:hicon-save"></span>  Save Changes
			</button>
		</div>
	
	</div>

<script>
function tvshowsController($scope,$http) {
    $http.get("http://da03d:15246/tvshows")
    .success(function(response) {$scope.tvshows = response;});

$scope.editController = function (tvshow){
	$scope.showEdition = true;
	$scope.id = tvshow._id;
	$scope.title = tvshow.title;
	$scope.year = tvshow.year;
};

$scope.saveController = function(_id, title, year){
	var tvshow = {
				id : _id,
				title : title,
				year : year
		};
	$http.put("http://da03d:15246/tvshows/" + _id, tvshow)
	.success(function(response){
		$http.get("http://da03d:15246/tvshows")
	    .success(function(response) {$scope.tvshows = response;});
		$scope.showEdition = false;
	});
};
}

</script>

</body>
</html>

